<html>
    <head>
        <style>
            body {
                background-color: wheat;
                font-family: monospace;
                display: flex;
                flex-direction: column;
                align-items: center;
                padding: 120px 0;
            }

            .main-container {
                width: 1000px;
            }

            em {
                font-family: serif;
                font-weight: bold;
            }

            thead, td:first-child {
                background-color: maroon;
                color: wheat;
            }

            td {
                text-align: center;
            }

            .valid-pair {
                background-color: tomato;
            }

            .cell {
                width: 30px;
            }

            p {
                white-space: pre-wrap;
            }

            pre {
                margin: 0;
            }

            .table-holder {
                overflow: auto;
            }
        </style>
    </head>
    <body>
        <div class="main-container">
            <pre class="md">
*1.4.40 3-sum for random value*. Formulate and validate a hypothesis describing the number of triples of N random int values that sum to *0*.  
If you are skilled in mathematical analysis, develop an appropriate mathematical model for this problem, where the values are uniformly distributed between *â€“M* and *M*, where M is not small.

---

### Some considerations and facts

For conveniency, I'll call pairs and triples that sum to *0* "balanced" triples.
Since balancing triples come from a pair whose sum is within the interval *[-M, M]*, I'll call these pairs "balanced" pairs too.

#### Minimum amount of valid triples

We have a list of integers *X* of length *N*. All these integers are evenly distributed within the interval *[-M, M]*.

Even so, there is a chance that all the integers are 1, for instance: *X = { 1, 1, 1, ..., 1 }*.
In this case we would have no triples that sum to *0*.
This shows that the minimum amount of triples that sum to *0* within an *N* list of integers is *0*.

#### Maximum amount of triples

WIP

### The probabilities

The table shows the possibles sums for a pair *(a, b)*, where a and b are integers within the interval *[-M, M]*.  
Highlighted values show pairs whose sum is also within the interval *[-M, M]*.  
            </pre>

            <form id="form">
                <label>value for M: </label>
                <input id="M-input" type="number" value="10"  min="0" max="150" />
                <input type="submit" value="Draw table" />
            </form>

            <div class="table-holder" id="table-holder"></div>

            <pre class="md">
The total possible pairs are *(2M + 1)^2 = 4M^2 + 4M + 1*.
The numbers that do not sum to a number within the interval *[-M, M]* form a rectangle of width *M(M + 1) = M^2 + M*.
This shows that the probability of a pair to be balanced is *3M^2 + 3M + 1 / (2M + 1)^2*.

### The number of balanced pairs within a list

Within a list of length *N* there is going to be *N^2/2 - N/2* pairs.  
Given the probabilities of a pair to be balanced, we should find aproximately *(N^2/2 - N/2) * (3M^2 + 3M + 1) / (2M + 1)^2* pairs within that list.

For instance, given *M = 50* and *N = 1000*, we should find around *374,637* balanced pairs.
            </pre>
        </div>

        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/marked/3.0.4/marked.min.js"
            integrity="sha512-a+W0h6Sho4fGYABZAQg6zdWP/qtyE+gzeVfNB/UApXRLuHKh7bT3TeA/LUOno+pcDjX0Vfzgtz6crFQC3YL9lA=="
            crossorigin="anonymous"
            referrerpolicy="no-referrer"
        ></script>

        <script>
            const PairsTable = {
                draw(M) {
                    const table = this._buildTable(M);
                    document.getElementById("table-holder").replaceChildren(table);
                },

                _buildTable(M) {
                    const table = this.el("table");
                    const thead = this._buildTableHeader(M);
                    this.appendTableRows(table, M);
                    table.append(thead);
                    return table;
                },

                appendTableRows(table, M) {
                    for (let i = -M; i <= M; i++) {
                        const tr = this.el("tr");

                        tr.append(this.cell("td", i));

                        for (let j = -M; j <= M; j++) {
                            const sum = i + j;
                            const td = this.cell("td", sum);
                            if (sum >= -M && sum <= M) td.className = "valid-pair";
                            tr.append(td);
                        }

                        table.append(tr);
                    }
                },

                _buildTableHeader(M) {
                    const thead = this.el("thead");
                    const header = this.el("tr");

                    header.append(this.cell("th"));

                    for (let i = -M; i <= M; i++) header.append(this.cell("th", i));

                    thead.append(header);

                    return thead;
                },

                cell(elementName, contents = "") {
                    const wrappedContents = this.el("div", contents, { className: "cell" });
                    return this.el(elementName, wrappedContents);
                },

                el(elementName, contents = "", { className = ""} = {}) {
                    const element = document.createElement(elementName);

                    element.className = className;

                    if (typeof contents === "string" || typeof contents === "number") {
                        element.innerText = contents;
                    } else if (typeof contents === "object") {
                        element.appendChild(contents);
                    } else {
                        throw "error, unexpected " + typeof contents;
                    }

                    return element;
                }
            };

            main();

            function main() {
                const form = document.getElementById("form");

                form.addEventListener("submit", (ev) => {
                    ev.preventDefault();
                    const M = document.getElementById("M-input").value;
                    PairsTable.draw(M);
                });

                form.querySelector("input").focus();

                PairsTable.draw(5);

                renderMarkdown();

                const M = 50;
                let a = 0;

                for (let i = 0; i < 1000; i++) {
                    const list = generateRandomIntegerList(1000, M);
                    a += countBalancedPairs(list, M);
                }

                console.log(a / 1000);
            }

            function renderMarkdown() {
                document.querySelectorAll(".md").forEach(el => {
                    el.innerHTML = marked(el.innerText);
                });
            }

            function generateRandomIntegerList(N, M) {
                const list = [];
                for (let i = 0; i < N; i++) list[i] = randomInteger(M);
                return list;
            }

            function randomInteger(M) {
                return Math.floor((Math.random() * (2*M + 1)) -M);
            }

            function countBalancedPairs(a, M) {
                const N = a.length;
                let count = 0;

                for (let i = 0; i < N; i++)
                    for (let j = i+1; j < N; j++) {
                        const sum = a[i] + a[j];
                        if (sum >= -M && sum <= M) count++;
                    }

                return count;
            }

            function countBalancingTriples(a) {
                const N = a.length;
                let count = 0;

                for (let i = 0; i < N; i++)
                    for (let j = i+1; j < N; j++)
                        for (let k = j+1; k < N; k++)
                            if (a[i] + a[j] + a[k] === 0) count++;

                return count;
            }
        </script>
    </body>
</html>